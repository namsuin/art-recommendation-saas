<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Art Recommendation - Í∞ÑÎã®Ìïú Î≤ÑÏ†Ñ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
</head>
<body class="bg-gray-50">
    <div id="root" class="min-h-screen"></div>

    <script>
        const { useState } = React;
        const { createRoot } = ReactDOM;

        function App() {
            const [uploadedImage, setUploadedImage] = useState(null);
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [analysisResult, setAnalysisResult] = useState(null);
            const [recommendations, setRecommendations] = useState([]);
            const [error, setError] = useState(null);

            const handleImageUpload = async (event) => {
                const file = event.target.files?.[0];
                if (!file) return;

                // Reset state
                setError(null);
                setRecommendations([]);
                setAnalysisResult(null);
                
                const imageUrl = URL.createObjectURL(file);
                setUploadedImage(imageUrl);
                setIsAnalyzing(true);

                try {
                    const formData = new FormData();
                    formData.append('image', file);

                    const response = await fetch('/api/analyze', {
                        method: 'POST',
                        body: formData,
                    });

                    const result = await response.json();
                    console.log('üîç API Response:', result);

                    if (!response.ok) {
                        throw new Error(result.error || 'ÏÑúÎ≤Ñ Ïò§Î•ò');
                    }

                    // Î∂ÑÏÑù Í≤∞Í≥º Ï†ÄÏû•
                    if (result.analysis) {
                        console.log('üìä Setting analysis result:', result.analysis);
                        setAnalysisResult(result.analysis);
                    }
                    
                    if (result.recommendations && result.recommendations.length > 0) {
                        setRecommendations(result.recommendations);
                    } else {
                        setError('Ï∂îÏ≤úÌï† ÏûëÌíàÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    }
                } catch (error) {
                    console.error('Image analysis failed:', error);
                    setError(error.message || 'Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                } finally {
                    setIsAnalyzing(false);
                }
            };

            return React.createElement('div', { className: 'container mx-auto px-4 py-8 max-w-4xl' },
                React.createElement('h1', { className: 'text-4xl font-bold text-center text-gray-800 mb-8' },
                    'üé® AI ÏïÑÌä∏ Ï∂îÏ≤ú ÏÑúÎπÑÏä§'
                ),
                
                // Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú
                React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-6 mb-6' },
                    React.createElement('h2', { className: 'text-xl font-semibold mb-4' }, 'Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú'),
                    React.createElement('input', {
                        type: 'file',
                        accept: 'image/*',
                        onChange: handleImageUpload,
                        className: 'w-full p-3 border border-gray-300 rounded-lg',
                        disabled: isAnalyzing
                    })
                ),

                // ÏóÖÎ°úÎìúÎêú Ïù¥ÎØ∏ÏßÄ
                uploadedImage && React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-6 mb-6' },
                    React.createElement('h2', { className: 'text-xl font-semibold mb-4' }, 'ÏóÖÎ°úÎìúÎêú Ïù¥ÎØ∏ÏßÄ'),
                    React.createElement('img', {
                        src: uploadedImage,
                        alt: 'Uploaded',
                        className: 'max-w-full h-auto rounded-lg mx-auto',
                        style: { maxHeight: '400px' }
                    })
                ),

                // Î∂ÑÏÑù ÏßÑÌñâ Ï§ë
                isAnalyzing && React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6 mb-6' },
                    React.createElement('div', { className: 'flex items-center space-x-3' },
                        React.createElement('div', { className: 'animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600' }),
                        React.createElement('div', null,
                            React.createElement('h3', { className: 'text-lg font-semibold text-gray-800' }, 'AIÍ∞Ä Ïù¥ÎØ∏ÏßÄÎ•º Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...'),
                            React.createElement('p', { className: 'text-sm text-gray-600' }, 'Google Vision, Clarifai Îì± Ïó¨Îü¨ AI Î™®Îç∏Ïù¥ ÏûëÎèô Ï§ëÏûÖÎãàÎã§')
                        )
                    )
                ),

                // Î∂ÑÏÑù Í≤∞Í≥º
                analysisResult && React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6 mb-6' },
                    React.createElement('h3', { className: 'text-xl font-bold text-gray-800 mb-4' },
                        'üîç AI Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Í≤∞Í≥º'
                    ),
                    React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                        // ÌÇ§ÏõåÎìú
                        React.createElement('div', { className: 'space-y-2' },
                            React.createElement('h4', { className: 'font-semibold text-gray-700' }, 'üè∑Ô∏è Í∞êÏßÄÎêú ÌÇ§ÏõåÎìú'),
                            React.createElement('div', { className: 'flex flex-wrap gap-2' },
                                analysisResult.keywords?.map((keyword, idx) =>
                                    React.createElement('span', {
                                        key: idx,
                                        className: 'px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm'
                                    }, keyword)
                                )
                            )
                        ),
                        // Ïä§ÌÉÄÏùº & Î∂ÑÏúÑÍ∏∞
                        React.createElement('div', { className: 'space-y-2' },
                            React.createElement('h4', { className: 'font-semibold text-gray-700' }, 'üé≠ Ïä§ÌÉÄÏùº & Î∂ÑÏúÑÍ∏∞'),
                            React.createElement('div', { className: 'text-sm text-gray-600' },
                                React.createElement('p', null, `Ïä§ÌÉÄÏùº: ${analysisResult.style}`),
                                React.createElement('p', null, `Î∂ÑÏúÑÍ∏∞: ${analysisResult.mood}`),
                                React.createElement('p', null, `Ïã†Î¢∞ÎèÑ: ${(analysisResult.confidence * 100).toFixed(1)}%`)
                            )
                        )
                    )
                ),

                // ÏóêÎü¨ Î©îÏãúÏßÄ
                error && React.createElement('div', { className: 'bg-red-50 border border-red-200 rounded-lg p-4 mb-6' },
                    React.createElement('p', { className: 'text-red-600' }, `‚ö†Ô∏è ${error}`)
                ),

                // Ï∂îÏ≤ú Í≤∞Í≥º
                recommendations.length > 0 && React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-6' },
                    React.createElement('h2', { className: 'text-xl font-semibold mb-4' }, 'üé® Ï∂îÏ≤ú ÏûëÌíà'),
                    React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4' },
                        recommendations.slice(0, 6).map((rec, idx) =>
                            React.createElement('div', {
                                key: idx,
                                className: 'border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow'
                            },
                                React.createElement('img', {
                                    src: rec.artwork.thumbnail_url || rec.artwork.image_url,
                                    alt: rec.artwork.title,
                                    className: 'w-full h-48 object-cover rounded-lg mb-2'
                                }),
                                React.createElement('h3', { className: 'font-semibold text-sm mb-1' }, rec.artwork.title),
                                React.createElement('p', { className: 'text-gray-600 text-xs mb-2' }, rec.artwork.artist),
                                React.createElement('p', { className: 'text-blue-600 text-xs' }, `Ïú†ÏÇ¨ÎèÑ: ${(rec.similarity * 100).toFixed(1)}%`)
                            )
                        )
                    )
                )
            );
        }

        // Ïï± Î†åÎçîÎßÅ
        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
        
        console.log('‚úÖ React app rendered successfully');
    </script>
</body>
</html>