<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡œí•„ - AI Art Recommendation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Chart.js for stats visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50">
    <div id="root" class="min-h-screen">
        <!-- Loading placeholder -->
        <div class="container mx-auto px-4 py-8">
            <h1 class="text-4xl font-bold text-center text-gray-800 mb-8">
                ì‚¬ìš©ì í”„ë¡œí•„
            </h1>
            <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6 text-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-4"></div>
                <p class="text-gray-600">ë¡œë”© ì¤‘...</p>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        // ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ë“¤
        const HeartIcon = ({ filled = false, className = "w-5 h-5" }) => (
            <svg className={className} fill={filled ? "currentColor" : "none"} stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} 
                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
            </svg>
        );

        const UserIcon = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} 
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
        );

        const UploadIcon = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} 
                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
        );

        const StatsIcon = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} 
                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
        );

        const EditIcon = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} 
                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
        );

        const CameraIcon = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} 
                    d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        );

        // í†µê³„ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
        const StatCard = ({ title, value, icon, color = "blue" }) => (
            <div className="bg-white rounded-lg shadow-lg p-6">
                <div className="flex items-center">
                    <div className={`p-3 rounded-full bg-${color}-100 text-${color}-600 mr-4`}>
                        {icon}
                    </div>
                    <div>
                        <p className="text-sm font-medium text-gray-600">{title}</p>
                        <p className="text-2xl font-bold text-gray-900">{value}</p>
                    </div>
                </div>
            </div>
        );

        // ì¢‹ì•„ìš”í•œ ì‘í’ˆ ê·¸ë¦¬ë“œ ì»´í¬ë„ŒíŠ¸
        const LikedArtworkGrid = ({ artworks, onUnlike }) => (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {artworks.map((artwork, index) => (
                    <div key={artwork.id || index} className="bg-white rounded-lg shadow-lg overflow-hidden">
                        <img
                            src={artwork.image_url || 'https://via.placeholder.com/300x300?text=No+Image'}
                            alt={artwork.title || 'ì‘í’ˆ'}
                            className="w-full h-48 object-cover"
                            onError={(e) => {
                                e.target.src = 'https://via.placeholder.com/300x300?text=Image+Not+Found';
                            }}
                        />
                        <div className="p-4">
                            <div className="flex justify-between items-start mb-2">
                                <div className="flex-1">
                                    <h3 className="font-semibold text-gray-900">{artwork.title || 'ì œëª© ì—†ìŒ'}</h3>
                                    <p className="text-sm text-gray-600">{artwork.artist || 'ì‘ê°€ ë¯¸ìƒ'}</p>
                                </div>
                                <button
                                    onClick={() => onUnlike(artwork)}
                                    className="text-red-500 hover:text-red-600 ml-2"
                                    title="ì¢‹ì•„ìš” ì·¨ì†Œ"
                                >
                                    <HeartIcon filled={true} />
                                </button>
                            </div>
                            <p className="text-xs text-gray-500">
                                ì¢‹ì•„ìš” ë‚ ì§œ: {new Date(artwork.liked_at || Date.now()).toLocaleDateString()}
                            </p>
                        </div>
                    </div>
                ))}
            </div>
        );

        // í”„ë¡œí•„ í¸ì§‘ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸
        const ProfileEditModal = ({ isOpen, onClose, user, onSave }) => {
            const [displayName, setDisplayName] = useState(user?.display_name || user?.user_metadata?.display_name || '');
            const [nickname, setNickname] = useState(user?.user_metadata?.nickname || '');
            const [profileImage, setProfileImage] = useState(null);
            const [profileImagePreview, setProfileImagePreview] = useState(user?.user_metadata?.profile_image_url || null);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');

            // ë‹‰ë„¤ì„ ì¶”ì²œ ëª©ë¡
            const nicknameOptions = [
                'ì•„íŠ¸ëŸ¬ë²„', 'ì‘í’ˆê°ìƒê°€', 'ë¯¸ìˆ ì• í˜¸ê°€', 'ê°¤ëŸ¬ë¦¬ì›Œì»¤', 'ì»¬ë ‰í„°', 'í¬ë¦¬ì—ì´í„°',
                'ì•„í‹°ìŠ¤íŠ¸', 'ë®¤ì§€ì—„í‚¤í¼', 'ì˜ˆìˆ íƒí—˜ê°€', 'ìƒ‰ì±„ë§ˆë²•ì‚¬', 'ë¶“ì§ˆë‹¬ì¸', 'ìº”ë²„ìŠ¤ë“œë¦¬ë¨¸'
            ];

            const handleImageChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) {
                        setError('ì´ë¯¸ì§€ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                        return;
                    }
                    if (!file.type.startsWith('image/')) {
                        setError('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                        return;
                    }
                    setError('');
                    setProfileImage(file);
                    
                    // ë¯¸ë¦¬ë³´ê¸° ìƒì„±
                    const reader = new FileReader();
                    reader.onload = (e) => setProfileImagePreview(e.target.result);
                    reader.readAsDataURL(file);
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                setError('');

                try {
                    const formData = new FormData();
                    formData.append('userId', user.id);
                    if (displayName.trim()) formData.append('displayName', displayName.trim());
                    if (nickname.trim()) formData.append('nickname', nickname.trim());
                    if (profileImage) formData.append('profileImage', profileImage);

                    const response = await fetch('/api/profile/update', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    console.log('Profile update result:', result);
                    
                    if (result.success) {
                        // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
                        const updatedUser = { 
                            ...user, 
                            display_name: displayName || user.email,
                            user_metadata: {
                                ...user.user_metadata,
                                display_name: displayName,
                                nickname,
                                profile_image_url: result.profileImageUrl || profileImagePreview
                            }
                        };
                        
                        console.log('Updated user data:', updatedUser);
                        onSave(updatedUser);
                        onClose();
                    } else {
                        setError(result.error || 'í”„ë¡œí•„ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('Profile update failed:', error);
                    setError('í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setIsLoading(false);
                }
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-xl font-semibold">í”„ë¡œí•„ í¸ì§‘</h2>
                            <button
                                onClick={onClose}
                                className="text-gray-500 hover:text-gray-700"
                            >
                                âœ•
                            </button>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-4">
                            {/* í”„ë¡œí•„ ì‚¬ì§„ */}
                            <div className="text-center">
                                <div className="relative inline-block">
                                    <div className="w-24 h-24 rounded-full overflow-hidden bg-gray-200 mx-auto">
                                        {profileImagePreview ? (
                                            <img 
                                                src={profileImagePreview} 
                                                alt="Profile" 
                                                className="w-full h-full object-cover"
                                            />
                                        ) : (
                                            <div className="w-full h-full flex items-center justify-center">
                                                <UserIcon className="w-8 h-8 text-gray-400" />
                                            </div>
                                        )}
                                    </div>
                                    <label className="absolute bottom-0 right-0 bg-blue-500 text-white p-2 rounded-full cursor-pointer hover:bg-blue-600">
                                        <CameraIcon className="w-4 h-4" />
                                        <input
                                            type="file"
                                            accept="image/*"
                                            onChange={handleImageChange}
                                            className="hidden"
                                        />
                                    </label>
                                </div>
                                <p className="text-sm text-gray-500 mt-2">í”„ë¡œí•„ ì‚¬ì§„ (5MB ì´í•˜)</p>
                            </div>

                            {/* í‘œì‹œ ì´ë¦„ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    í‘œì‹œ ì´ë¦„
                                </label>
                                <input
                                    type="text"
                                    value={displayName}
                                    onChange={(e) => setDisplayName(e.target.value)}
                                    placeholder="ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ í‘œì‹œë  ì´ë¦„"
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </div>

                            {/* ë‹‰ë„¤ì„ ì„ íƒ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ë‹‰ë„¤ì„ (ë³„ëª…)
                                </label>
                                <input
                                    type="text"
                                    value={nickname}
                                    onChange={(e) => setNickname(e.target.value)}
                                    placeholder="ì›í•˜ëŠ” ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ê±°ë‚˜ ì•„ë˜ì—ì„œ ì„ íƒ"
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-3"
                                />
                                
                                <div className="grid grid-cols-2 gap-2">
                                    {nicknameOptions.map((option, index) => (
                                        <button
                                            key={index}
                                            type="button"
                                            onClick={() => setNickname(option)}
                                            className="p-2 text-sm bg-gray-100 hover:bg-blue-100 text-gray-700 hover:text-blue-700 rounded border"
                                        >
                                            {option}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {error && (
                                <div className="p-3 bg-red-100 border border-red-400 text-red-700 rounded">
                                    {error}
                                </div>
                            )}

                            <div className="flex space-x-3 pt-4">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 py-2 px-4 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                >
                                    ì·¨ì†Œ
                                </button>
                                <button
                                    type="submit"
                                    disabled={isLoading}
                                    className="flex-1 py-2 px-4 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-blue-300"
                                >
                                    {isLoading ? 'ì €ì¥ ì¤‘...' : 'ì €ì¥'}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // ì—…ë¡œë“œ íˆìŠ¤í† ë¦¬ ì»´í¬ë„ŒíŠ¸
        const UploadHistory = ({ history }) => (
            <div className="space-y-4">
                {history.map((item, index) => (
                    <div key={item.id || index} className="bg-white rounded-lg shadow p-6">
                        <div className="flex justify-between items-start mb-3">
                            <div>
                                <h3 className="font-semibold text-gray-900">ì—…ë¡œë“œ #{item.id}</h3>
                                <p className="text-sm text-gray-600">
                                    {new Date(item.upload_date).toLocaleDateString()}
                                </p>
                            </div>
                            <span className="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">
                                {item.style}
                            </span>
                        </div>
                        
                        <div className="mb-3">
                            <p className="text-sm text-gray-600 mb-2">ì¶”ì¶œëœ í‚¤ì›Œë“œ:</p>
                            <div className="flex flex-wrap gap-2">
                                {item.keywords.map((keyword, idx) => (
                                    <span key={idx} className="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">
                                        {keyword}
                                    </span>
                                ))}
                            </div>
                        </div>
                        
                        <p className="text-sm text-gray-600">
                            ì¶”ì²œ ì‘í’ˆ ìˆ˜: <span className="font-semibold">{item.recommendations_count}ê°œ</span>
                        </p>
                    </div>
                ))}
            </div>
        );

        // ë©”ì¸ í”„ë¡œí•„ ì•± ì»´í¬ë„ŒíŠ¸
        const ProfileApp = () => {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('liked');
            const [likedArtworks, setLikedArtworks] = useState([]);
            const [uploadHistory, setUploadHistory] = useState([]);
            const [stats, setStats] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [isEditModalOpen, setIsEditModalOpen] = useState(false);

            // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
            const loadUser = async () => {
                try {
                    // localStorageì—ì„œ ì €ì¥ëœ í† í° ê°€ì ¸ì˜¤ê¸°
                    const accessToken = localStorage.getItem('supabase_access_token');
                    const userInfo = localStorage.getItem('user_info');
                    
                    console.log('ğŸ” í”„ë¡œí•„ í˜ì´ì§€ ì¸ì¦ í™•ì¸:');
                    console.log('  - í† í° ìˆìŒ:', !!accessToken);
                    console.log('  - ì‚¬ìš©ì ì •ë³´ ìˆìŒ:', !!userInfo);
                    
                    const headers = {
                        'Content-Type': 'application/json'
                    };
                    
                    // í† í°ì´ ìˆìœ¼ë©´ Authorization í—¤ë”ì— ì¶”ê°€
                    if (accessToken) {
                        headers['Authorization'] = `Bearer ${accessToken}`;
                    }
                    
                    const response = await fetch('/api/auth/user', { headers });
                    const result = await response.json();
                    
                    if (result.success) {
                        console.log('âœ… ì‚¬ìš©ì ì¸ì¦ ì„±ê³µ:', result.user.email);
                        setUser(result.user);
                        return result.user;
                    } else {
                        console.log('âŒ ì‚¬ìš©ì ì¸ì¦ ì‹¤íŒ¨:', result.error);
                        
                        // í† í°ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš° localStorage ì •ë¦¬
                        if (accessToken) {
                            localStorage.removeItem('supabase_access_token');
                            localStorage.removeItem('user_info');
                        }
                        
                        setError('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                        return null;
                    }
                } catch (error) {
                    console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                    setError('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return null;
                }
            };

            // ì¢‹ì•„ìš”í•œ ì‘í’ˆ ë¡œë“œ
            const loadLikedArtworks = async (userId) => {
                try {
                    const response = await fetch(`/api/profile/liked-artworks?userId=${userId}&limit=20`);
                    const result = await response.json();
                    if (result.success) {
                        setLikedArtworks(result.likedArtworks || []);
                    }
                } catch (error) {
                    console.error('Failed to load liked artworks:', error);
                }
            };

            // ì—…ë¡œë“œ íˆìŠ¤í† ë¦¬ ë¡œë“œ
            const loadUploadHistory = async (userId) => {
                try {
                    const response = await fetch(`/api/profile/upload-history?userId=${userId}&limit=10`);
                    const result = await response.json();
                    if (result.success) {
                        setUploadHistory(result.history || []);
                    }
                } catch (error) {
                    console.error('Failed to load upload history:', error);
                }
            };

            // í†µê³„ ë¡œë“œ
            const loadStats = async (userId) => {
                try {
                    const response = await fetch(`/api/profile/stats?userId=${userId}`);
                    const result = await response.json();
                    if (result.success) {
                        setStats(result.stats);
                    }
                } catch (error) {
                    console.error('Failed to load stats:', error);
                }
            };

            // ì¢‹ì•„ìš” ì·¨ì†Œ
            const handleUnlike = async (artwork) => {
                if (!user) return;
                
                try {
                    const response = await fetch('/api/social/artwork/unlike', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: user.id,
                            artworkId: artwork.id,
                            sourcePlatform: artwork.source_platform || 'met'
                        })
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        // ëª©ë¡ì—ì„œ ì œê±°
                        setLikedArtworks(prev => prev.filter(a => a.id !== artwork.id));
                        // í†µê³„ ì—…ë°ì´íŠ¸
                        if (stats) {
                            setStats(prev => ({ ...prev, total_likes: prev.total_likes - 1 }));
                        }
                    } else {
                        alert('ì¢‹ì•„ìš” ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + result.error);
                    }
                } catch (error) {
                    console.error('Unlike failed:', error);
                    alert('ì¢‹ì•„ìš” ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            };

            useEffect(() => {
                const initializeProfile = async () => {
                    const userData = await loadUser();
                    if (userData) {
                        await Promise.all([
                            loadLikedArtworks(userData.id),
                            loadUploadHistory(userData.id),
                            loadStats(userData.id)
                        ]);
                    }
                    setLoading(false);
                };
                
                initializeProfile();
            }, []);

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <p className="text-red-600 mb-4">{error}</p>
                            <a href="/" className="text-blue-500 hover:text-blue-600">
                                í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
                            </a>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* í—¤ë” */}
                    <header className="bg-white shadow-sm border-b">
                        <div className="container mx-auto px-4 py-4">
                            <div className="flex items-center justify-between">
                                <a href="/" className="text-2xl font-bold text-gray-800 hover:text-blue-600 transition-colors">
                                    AI Art Recommendation
                                </a>
                                <div className="flex items-center space-x-4">
                                    <a href="/social" className="text-gray-600 hover:text-blue-600">ì»¤ë®¤ë‹ˆí‹°</a>
                                    <span className="text-gray-700">{user?.display_name || user?.email}</span>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* ë©”ì¸ ì»¨í…ì¸  */}
                    <main className="container mx-auto px-4 py-8">
                        {/* í”„ë¡œí•„ í¸ì§‘ ëª¨ë‹¬ */}
                        <ProfileEditModal 
                            isOpen={isEditModalOpen} 
                            onClose={() => setIsEditModalOpen(false)}
                            user={user}
                            onSave={async (updatedUser) => {
                                console.log('Profile updated, refreshing user data...');
                                // ì‚¬ìš©ì ì •ë³´ë¥¼ ì„œë²„ì—ì„œ ë‹¤ì‹œ ë¡œë“œ
                                const refreshedUser = await loadUser();
                                // í†µê³„ë„ ë‹¤ì‹œ ë¡œë“œ
                                if (refreshedUser?.id) {
                                    await loadStats(refreshedUser.id);
                                }
                                console.log('Profile refresh complete');
                            }}
                        />

                        {/* í”„ë¡œí•„ í—¤ë” */}
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-8">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-4">
                                    <div className="w-20 h-20 bg-gray-300 rounded-full overflow-hidden flex items-center justify-center">
                                        {user?.user_metadata?.profile_image_url ? (
                                            <img 
                                                src={user.user_metadata.profile_image_url} 
                                                alt="Profile" 
                                                className="w-full h-full object-cover"
                                            />
                                        ) : (
                                            <UserIcon className="w-10 h-10 text-gray-500" />
                                        )}
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-800">
                                            {user?.display_name || user?.user_metadata?.display_name || user?.email || 'ì‚¬ìš©ì'}
                                        </h1>
                                        <p className="text-gray-600">
                                            {user?.user_metadata?.nickname && (
                                                <span className="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm mr-2">
                                                    {user.user_metadata.nickname}
                                                </span>
                                            )}
                                            AI ì•„íŠ¸ ì• í˜¸ê°€ â€¢ íšŒì› ê°€ì…ì¼: {stats ? new Date(stats.member_since).toLocaleDateString() : 'ì•Œ ìˆ˜ ì—†ìŒ'}
                                        </p>
                                    </div>
                                </div>
                                <button
                                    onClick={() => setIsEditModalOpen(true)}
                                    className="flex items-center space-x-2 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg"
                                >
                                    <EditIcon className="w-4 h-4" />
                                    <span>í¸ì§‘</span>
                                </button>
                            </div>
                        </div>

                        {/* í†µê³„ ì¹´ë“œë“¤ */}
                        {stats && (
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                <StatCard 
                                    title="ì´ ì—…ë¡œë“œ" 
                                    value={stats.total_uploads} 
                                    icon={<UploadIcon />} 
                                    color="blue" 
                                />
                                <StatCard 
                                    title="ì¢‹ì•„ìš”í•œ ì‘í’ˆ" 
                                    value={stats.total_likes} 
                                    icon={<HeartIcon />} 
                                    color="red" 
                                />
                                <StatCard 
                                    title="ì„ í˜¸ ìŠ¤íƒ€ì¼" 
                                    value={stats.favorite_styles[0] || 'ì—†ìŒ'} 
                                    icon={<StatsIcon />} 
                                    color="green" 
                                />
                                <StatCard 
                                    title="í™œë™ ì ìˆ˜" 
                                    value={stats.total_uploads + stats.total_likes} 
                                    icon={<StatsIcon />} 
                                    color="purple" 
                                />
                            </div>
                        )}

                        {/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}
                        <div className="bg-white rounded-lg shadow-lg mb-6">
                            <div className="border-b">
                                <nav className="flex">
                                    <button
                                        onClick={() => setActiveTab('liked')}
                                        className={`px-6 py-4 font-medium ${
                                            activeTab === 'liked'
                                                ? 'border-b-2 border-blue-500 text-blue-600'
                                                : 'text-gray-600 hover:text-blue-600'
                                        }`}
                                    >
                                        ì¢‹ì•„ìš”í•œ ì‘í’ˆ ({likedArtworks.length})
                                    </button>
                                    <button
                                        onClick={() => setActiveTab('history')}
                                        className={`px-6 py-4 font-medium ${
                                            activeTab === 'history'
                                                ? 'border-b-2 border-blue-500 text-blue-600'
                                                : 'text-gray-600 hover:text-blue-600'
                                        }`}
                                    >
                                        ì—…ë¡œë“œ íˆìŠ¤í† ë¦¬ ({uploadHistory.length})
                                    </button>
                                </nav>
                            </div>

                            {/* íƒ­ ì»¨í…ì¸  */}
                            <div className="p-6">
                                {activeTab === 'liked' && (
                                    <div>
                                        <h2 className="text-xl font-semibold mb-4">ì¢‹ì•„ìš”í•œ ì‘í’ˆ</h2>
                                        {likedArtworks.length > 0 ? (
                                            <LikedArtworkGrid 
                                                artworks={likedArtworks} 
                                                onUnlike={handleUnlike} 
                                            />
                                        ) : (
                                            <div className="text-center py-12">
                                                <HeartIcon className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                                <p className="text-gray-500 text-lg">ì•„ì§ ì¢‹ì•„ìš”í•œ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                                <p className="text-gray-400">ì‘í’ˆì„ íƒìƒ‰í•˜ê³  ë§ˆìŒì— ë“œëŠ” ì‘í’ˆì— ì¢‹ì•„ìš”ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”!</p>
                                                <a 
                                                    href="/" 
                                                    className="inline-block mt-4 bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg"
                                                >
                                                    ì‘í’ˆ íƒìƒ‰í•˜ê¸°
                                                </a>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {activeTab === 'history' && (
                                    <div>
                                        <h2 className="text-xl font-semibold mb-4">ì—…ë¡œë“œ íˆìŠ¤í† ë¦¬</h2>
                                        {uploadHistory.length > 0 ? (
                                            <UploadHistory history={uploadHistory} />
                                        ) : (
                                            <div className="text-center py-12">
                                                <UploadIcon className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                                <p className="text-gray-500 text-lg">ì•„ì§ ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                                                <p className="text-gray-400">ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì—¬ AI ë¶„ì„ê³¼ ì¶”ì²œì„ ë°›ì•„ë³´ì„¸ìš”!</p>
                                                <a 
                                                    href="/" 
                                                    className="inline-block mt-4 bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg"
                                                >
                                                    ì´ë¯¸ì§€ ì—…ë¡œë“œí•˜ê¸°
                                                </a>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        // ì•± ë Œë”ë§
        const rootElement = document.getElementById('root');
        if (rootElement) {
            const root = createRoot(rootElement);
            root.render(<ProfileApp />);
        }
    </script>
</body>
</html>